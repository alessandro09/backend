databaseChangeLog:
  - changeSet:
     id: create-tables
     author:  alessandro.abegg
     changes:
       - createTable:
           tableName: ORIGIN  
           columns:
             - column:  
                 name: YEAR
                 type: integer
                 constraints:
                   nullable: false
             - column:
                 name: TITLE
                 type: varchar(200)
                 constraints:
                   nullable: false
             - column:
                 name: STUDIOS
                 type: varchar(200)
                 constraints:
                   nullable: false
             - column:
                 name: PRODUCERS
                 type: varchar(200)
                 constraints:
                   nullable: false
             - column:
                 name: WINNER
                 type: boolean
       - createTable:
           tableName: STUDIO  
           columns:
             - column:  
                 name: ID
                 type: bigint
                 autoIncrement: true
                 constraints:
                   nullable: false
                   primaryKey: true
             - column:
                 name: name
                 type: varchar(200)
       - createTable:
           tableName: PRODUCER  
           columns:
             - column:  
                 name: ID
                 type: bigint
                 autoIncrement: true
                 constraints:
                   nullable: false
                   primaryKey: true
             - column:
                 name: name
                 type: varchar(200)
       - createTable:
           tableName: MOVIE  
           columns:
             - column:  
                 name: ID
                 type: bigint
                 autoIncrement: true
                 constraints:
                   nullable: false
                   primaryKey: true
             - column:  
                 name: YEAR
                 type: integer
                 constraints:
                   nullable: false
             - column:  
                 name: TITLE
                 type: varchar(200)
                 constraints:
                   nullable: false
             - column:
                 name: WINNER
                 type: boolean
       - createTable:
           tableName: STUDIO_MOVIE
           columns:
             - column:  
                 name: ID
                 type: bigint
                 autoIncrement: true
                 constraints:
                   nullable: false
                   primaryKey: true
             - column:  
                 name: ID_STUDIO
                 type: bigint
                 constraints:
                   nullable: false
                   foreignKeyName: fk_studio_studio
                   references: STUDIO(ID)
             - column:  
                 name: ID_MOVIE
                 type: bigint
                 constraints:
                   nullable: false
                   foreignKeyName: fk_studio_movie
                   references: MOVIE(ID)
       - createTable:
           tableName: producer_movie
           columns:
             - column:  
                 name: ID
                 type: bigint
                 autoIncrement: true
                 constraints:
                   nullable: false
                   primaryKey: true
             - column:  
                 name: ID_PRODUCER
                 type: bigint
                 constraints:
                   nullable: false
                   foreignKeyName: fk_producer_producer
                   references: PRODUCER(ID)
             - column:  
                 name: ID_MOVIE
                 type: bigint
                 constraints:
                   nullable: false
                   foreignKeyName: fk_producer_movie
                   references: MOVIE(ID)


  - changeSet:
     id: import-from-csv
     author:  alessandro.abegg
     changes:
       - loadData:
           encoding: UTF-8
           file: movielist.csv
           separator: ;
           usePreparedStatements: true
           tableName: ORIGIN
           columns:
             - column:
               header: YEAR
               type: integer
             - column:
               header: TITLE
               type: varchat(100)
             - column:
               header: STUDIOS
               type: varchat(100)
             - column:
               header: PRODUCERS
               type: varchat(100)
             - column:
               header: WINNER
               type: boolean

  - changeSet:
     id: load-studios-and-producers
     author:  alessandro.abegg
     changes:
       - customChange:
           class: br.com.texo.testback.backend.services.liquibase.CustomLoadStudiosAndProducers

  - changeSet:
     id: load-MOVIE
     author:  alessandro.abegg
     changes:
       - sql:
           sql: "
             INSERT INTO MOVIE(\"YEAR\", TITLE, WINNER)
             SELECT \"YEAR\",
                    TITLE,
                    WINNER
               FROM ORIGIN"

  - changeSet:
     id: load-ref-movie-to-studio
     author:  alessandro.abegg
     changes:
       - customChange:
           class: br.com.texo.testback.backend.services.liquibase.CustomLoadStudiosAndProducers

  - changeSet:
     id: load-ref-movie
     author:  alessandro.abegg
     changes:
       - customChange:
           class: br.com.texo.testback.backend.services.liquibase.CustomSqlGenerateRefs

#  - changeSet:
#      id:  dropTable-ORIGIN
#      author:  liquibase-docs
#      changes:
#        - dropTable:
#            tableName:  ORIGIN
